/*
Copyright (c) 2010, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 3.5.0
build: nightly
*/
YUI.add("widget-buttons",function(c){var i=c.Array,k=c.Lang,f=c.Object,a=c.Plugin.Button,j=c.Widget,m=c.WidgetStdMod,d=c.ClassNameManager.getClassName,e=k.isArray,l=k.isNumber,b=k.isString,h=k.isValue;function g(){if(!this._stdModNode){c.error("WidgetStdMod must be added to a Widget before WidgetButtons.");}this._buttonsHandles={};}g.ATTRS={buttons:{getter:"_getButtons",setter:"_setButtons",value:{}},defaultButton:{readOnly:true,value:null}};g.CLASS_NAMES={button:d("button"),buttons:j.getClassName("buttons"),primary:d("button","primary")};g.HTML_PARSER={buttons:function(n){return this._parseButtons(n);}};g.NON_BUTTON_NODE_CFG=["action","classNames","context","events","isDefault","section"];g.prototype={BUTTONS:{},BUTTONS_TEMPLATE:"<span />",DEFAULT_BUTTONS_SECTION:m.FOOTER,initializer:function(){this._mapButtons(this.get("buttons"));this._updateDefaultButton();this.after("buttonsChange",c.bind("_afterButtonsChange",this));c.after(this._bindUIButtons,this,"bindUI");c.after(this._syncUIButtons,this,"syncUI");},destructor:function(){f.each(this._buttonsHandles,function(n){n.detach();});delete this._buttonsHandles;delete this._buttonsMap;delete this._defaultButton;},addButton:function(o,r,n){var q=this.get("buttons"),p;if(!c.instanceOf(o,c.Node)){o=this._mergeButtonConfig(o);r||(r=o.section);}r||(r=this.DEFAULT_BUTTONS_SECTION);p=q[r]||(q[r]=[]);l(n)||(n=p.length);p.splice(n,0,o);this.set("buttons",q,{button:o,section:r,index:n,src:"add"});return this;},getButton:function(n,q){if(!h(n)){return;}var p=this._buttonsMap,o;q||(q=this.DEFAULT_BUTTONS_SECTION);if(l(n)){o=this.get("buttons");return o[q]&&o[q][n];}return arguments.length>1?p[q+":"+n]:p[n];},removeButton:function(o,q){if(!h(o)){return this;}var p=this.get("buttons"),n;if(l(o)){q||(q=this.DEFAULT_BUTTONS_SECTION);n=o;o=p[q][n];}else{if(b(o)){o=this.getButton.apply(this,arguments);}f.some(p,function(r,s){n=i.indexOf(r,o);if(n>-1){q=s;return true;}});}if(o&&n>-1){p[q].splice(n,1);this.set("buttons",p,{button:o,section:q,index:n,src:"remove"});}return this;},_bindUIButtons:function(){var n=c.bind("_afterContentChangeButtons",this);this.after({defaultButtonChange:c.bind("_afterDefaultButtonChange",this),visibleChange:c.bind("_afterVisibleChangeButtons",this),headerContentChange:n,bodyContentChange:n,footerContentChange:n});},_createButton:function(s){var p,o,v,r,u,q,n,t;if(c.instanceOf(s,c.Node)){return s.plug(a);}p=c.merge({context:this,events:"click",label:s.value},s);o=c.merge(p);v=g.NON_BUTTON_NODE_CFG;for(r=0,u=v.length;r<u;r+=1){delete o[v[r]];}s=a.createNode(o);n=p.context;q=p.action;if(b(q)){q=c.bind(q,n);}t=s.on(p.events,q,n);this._buttonsHandles[c.stamp(s,true)]=t;s.setData("name",this._getButtonName(p));s.setData("default",this._getButtonDefault(p));i.each(i(p.classNames),s.addClass,s);return s;},_getButtonContainer:function(s,q){var t=m.SECTION_CLASS_NAMES[s],r=g.CLASS_NAMES.buttons,p=this.get("contentBox"),n,o;n="."+t+" ."+r;o=p.one(n);if(!o&&q){o=c.Node.create(this.BUTTONS_TEMPLATE);o.addClass(r);}return o;},_getButtonDefault:function(n){var o=c.instanceOf(n,c.Node)?n.getData("default"):n.isDefault;if(b(o)){return o.toLowerCase()==="true";}return !!o;},_getButtonName:function(o){var n;if(c.instanceOf(o,c.Node)){n=o.getData("name")||o.get("name");}else{n=o&&(o.name||o.type);}return n;},_getButtons:function(o){var n={};f.each(o,function(p,q){n[q]=p.concat();});return n;},_mapButton:function(o,r){var q=this._buttonsMap,n=this._getButtonName(o),p=this._getButtonDefault(o);if(n){q[n]=o;q[r+":"+n]=o;}p&&(this._defaultButton=o);},_mapButtons:function(n){this._buttonsMap={};this._defaultButton=null;f.each(n,function(q,r){var p,o;for(p=0,o=q.length;p<o;p+=1){this._mapButton(q[p],r);}},this);},_mergeButtonConfig:function(q){var n,t,p,s,r,o;q=b(q)?{name:q}:c.merge(q);if(q.srcNode){s=q.srcNode;r=s.get("tagName").toLowerCase();o=s.get(r==="input"?"value":"text");n={disabled:!!s.get("disabled"),isDefault:this._getButtonDefault(s),name:this._getButtonName(s)};o&&(n.label=o);c.mix(q,n,false,null,0,true);}p=this._getButtonName(q);t=this.BUTTONS&&this.BUTTONS[p];if(t){c.mix(q,t,false,null,0,true);}return q;},_parseButtons:function(p){var n="."+g.CLASS_NAMES.button,q=["header","body","footer"],o=null;i.each(q,function(u){var r=this._getButtonContainer(u),t=r&&r.all(n),s;if(!t||t.isEmpty()){return;}s=[];t.each(function(v){s.push({srcNode:v});});o||(o={});o[u]=s;},this);return o;},_setButtons:function(p){var o=this.DEFAULT_BUTTONS_SECTION,q={};function n(u,w){if(!e(u)){return;}var t,r,s,v;for(t=0,r=u.length;t<r;t+=1){s=u[t];v=w;if(!c.instanceOf(s,c.Node)){s=this._mergeButtonConfig(s);v||(v=s.section);}s=this._createButton(s);v||(v=o);(q[v]||(q[v]=[])).push(s);}}if(e(p)){n.call(this,p);}else{f.each(p,n,this);}return q;},_syncUIButtons:function(){this._uiSetButtons(this.get("buttons"));this._uiSetDefaultButton(this.get("defaultButton"));this._uiSetVisibleButtons(this.get("visible"));},_uiInsertButton:function(p,s,o){var r=g.CLASS_NAMES.button,n=this._getButtonContainer(s,true),q=n.all("."+r);n.insertBefore(p,q.item(o));this.setStdModContent(s,n,"after");},_uiRemoveButton:function(r,u,o){var q=c.stamp(r,this),p=this._buttonsHandles,t=p[q],n,s;t&&t.detach();delete p[q];r.remove();o||(o={});if(!o.preserveContent){n=this._getButtonContainer(u);s=g.CLASS_NAMES.button;if(n&&n.all("."+s).isEmpty()){n.remove();this._updateContentButtons(u);}}},_uiSetButtons:function(n){var o=g.CLASS_NAMES.button,p=["header","body","footer"];i.each(p,function(x){var v=n[x]||[],s=v.length,y=this._getButtonContainer(x,s),w=false,r,t,u,q;if(!y){return;}r=y.all("."+o);for(t=0;t<s;t+=1){u=v[t];q=r?r.indexOf(u):-1;if(q>-1){r.splice(q,1);if(q!==t){y.insertBefore(u,t+1);w=true;}}else{y.appendChild(u);w=true;}}r.each(function(z){this._uiRemoveButton(z,x,{preserveContent:true});w=true;},this);if(s===0){y.remove();this._updateContentButtons(x);return;}if(w){this.setStdModContent(x,y,"after");}},this);},_uiSetDefaultButton:function(p,o){var n=g.CLASS_NAMES.primary;p&&p.addClass(n);o&&o.removeClass(n);
},_uiSetVisibleButtons:function(o){if(!o){return;}var n=this.get("defaultButton");if(n){n.focus();}},_unMapButton:function(p,r){var q=this._buttonsMap,o=this._getButtonName(p),n;if(o){if(q[o]===p){delete q[o];}n=r+":"+o;if(q[n]===p){delete q[n];}}if(this._defaultButton===p){this._defaultButton=null;}},_updateDefaultButton:function(){var n=this._defaultButton;if(this.get("defaultButton")!==n){this._set("defaultButton",n);}},_updateContentButtons:function(o){var n=this.getStdModNode(o).get("childNodes");this.set(o+"Content",n.isEmpty()?null:n,{src:"buttons"});},_afterButtonsChange:function(r){var p=r.newVal,q=r.section,n=r.index,s=r.src,o;if(s==="add"){o=p[q][n];this._mapButton(o,q);this._updateDefaultButton();this._uiInsertButton(o,q,n);return;}if(s==="remove"){o=r.button;this._unMapButton(o,q);this._updateDefaultButton();this._uiRemoveButton(o,q);return;}this._mapButtons(p);this._updateDefaultButton();this._uiSetButtons(p);},_afterContentChangeButtons:function(o){var p=o.src,q=o.stdModPosition,n=!q||q===m.REPLACE;if(n&&p!=="buttons"&&p!==j.UI_SRC){this._uiSetButtons(this.get("buttons"));}},_afterDefaultButtonChange:function(n){this._uiSetDefaultButton(n.newVal,n.prevVal);},_afterVisibleChangeButtons:function(n){this._uiSetVisibleButtons(n.newVal);}};c.WidgetButtons=g;},"3.5.0",{requires:["button-plugin","cssbutton","widget-stdmod"]});