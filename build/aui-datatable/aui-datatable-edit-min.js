AUI.add("aui-datatable-edit",function(aq){var ab=aq.Lang,a9=aq.Array,e=ab.isArray,aM=ab.isBoolean,aI=ab.isFunction,H=ab.isObject,aR=ab.isString,aH=ab.String,a3=aq.DataType,aY=function(A){return(A instanceof aq.BaseCellEditor);},an=aq.WidgetStdMod,y=aq.getClassName,aS="activeCell",ad="add",aZ="addOption",aG="baseCellEditor",q="boundingBox",P="calendar",aj="cancel",aK="cell",av="celleditor",z="checkboxCellEditor",n="checked",aD="click",u="contentBox",O="datatable",K="dateCellEditor",ai="dd",T="delete",am="disk",aC="dotted",aJ="dropDownCellEditor",L="edit",E="editEvent",ag="editOptions",X="editable",f="editor",G="element",aA="elementName",c="grip",D="handle",t="hide",at="hideOnSave",af="icon",m="initEdit",a8="initToolbar",ar="initValidator",Z="input",d="inputFormatter",a7="key",au="label",ao="link",V="mousedown",Y="multiple",k="name",aO="option",aU="options",s="optionsCellEditor",a4="outputFormatter",j="pencil",ah="radioCellEditor",a5="remove",a1="rendered",ae="return",l="row",aF="save",aP="selected",ay="selectedAttrName",W="showToolbar",aT="submit",Q="textAreaCellEditor",w="textCellEditor",N="toolbar",x="unescapeValue",U="validator",aX="value",ap="vertical",ac="visible",aV="wrapper",B="zIndex",bc=",",h=".",R="",a0="\n",a6=" ",r=/<br\s*\/?>/gi,C=/[\r\n]/g,b=y(av,L),g=y(av,L,ad,aO),bb=y(av,L,ai,D),aN=y(av,L,T,aO),a2=y(av,L,t,aO),aw=y(av,L,Z,k),aE=y(av,L,Z,aX),al=y(av,L,au),o=y(av,L,ao),az=y(av,L,aO,l),S=y(av,G),aQ=y(av,au),J=y(av,aO),v=y(av,aV),F=y(O,X),i=y(af),aa=y(af,c,aC,ap),aL="<br/>";var aW=function(){};aW.NAME="dataTableCellEditorSupport";aW.EDITOR_ZINDEX=9999;aW.ATTRS={editEvent:{setter:"_setEditEvent",validator:aR,value:aD}};aq.mix(aW.prototype,{initializer:function(){var A=this,bd=A.get(E);A.CLASS_NAMES_CELL_EDITOR_SUPPORT={cell:A.getClassName(aK)};A.delegate(bd,A._onEditCell,h+A.CLASS_NAMES_CELL_EDITOR_SUPPORT.cell,A);},getEditor:function(bd,bf){var A=this,be=bf.editor,bg=bd.get(f);if(be===false||bg===false){return null;}return bg||be;},_onEditCell:function(bi){var A=this,bf=A.get(aS),be=bi.alignNode||bf,bh=A.getColumn(be),bd=A.getRecord(be),bg=A.getEditor(bd,bh);if(aY(bg)){if(!bg.get(a1)){bg.on({visibleChange:aq.bind(A._onEditorVisibleChange,A),save:aq.bind(A._onEditorSave,A)});bg.set(B,aW.EDITOR_ZINDEX);bg.render();}bg.set(aX,bd.get(bh.key));bg.show().move(be.getXY());}},_onEditorSave:function(bg){var A=this,bf=bg.currentTarget,be=A.getActiveColumn(),bd=A.getActiveRecord();bf.set(aX,bg.newVal);A.set(aS,A.get(aS));bd.set(be.key,bg.newVal);if(A.highlight){A.highlight.clear();}},_onEditorVisibleChange:function(be){var A=this,bd=be.currentTarget;if(be.newVal){bd._syncFocus();}},getCellEditor:function(){return this.getEditor.apply(this,arguments);},getRecordColumnValue:function(A,bd){return A.get(bd.key);}});aq.DataTable.CellEditorSupport=aW;aq.Base.mix(aq.DataTable,[aW]);var p=aq.Component.create({NAME:aG,ATTRS:{editable:{value:false,validator:aM},elementName:{value:aX,validator:aR},footerContent:{value:R},hideOnSave:{value:true,validator:aM},inputFormatter:{value:function(A){if(aR(A)){A=A.replace(C,aL);}return A;}},outputFormatter:{value:function(bd){var A=this;if(aR(bd)){if(A.get(x)){bd=aH.unescapeEntities(bd);}bd=bd.replace(r,a0);}return bd;}},showToolbar:{value:true,validator:aM},strings:{value:{edit:"Edit",save:"Save",cancel:"Cancel"}},tabIndex:{value:1},toolbar:{setter:"_setToolbar",validator:H,value:null},unescapeValue:{value:true,validator:aM},validator:{setter:"_setValidator",validator:H,value:null},value:{value:R},visible:{value:false}},EXTENDS:aq.Overlay,UI_ATTRS:[X,W,aX],prototype:{CONTENT_TEMPLATE:"<form></form>",ELEMENT_TEMPLATE:null,elements:null,validator:null,_hDocMouseDownEv:null,initializer:function(bd){var A=this;A._initEvents();},destructor:function(){var bd=this;var A=bd._hDocMouseDownEv;var bf=bd.toolbar;var be=bd.validator;if(A){A.detach();}if(bf){bf.destroy();}if(be){be.destroy();}},bindUI:function(){var A=this;A.get(q).on(a7,aq.bind(A._onEscKey,A),"down:27");},formatValue:function(bd,be){var A=this;if(aI(bd)){be=bd.call(A,be);}return be;},getValue:function(){var A=this;return A.formatValue(A.get(d),A.getElementsValue());},_initEvents:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn},initEdit:{defaultFn:A._defInitEditFn,fireOnce:true},initValidator:{defaultFn:A._defInitValidatorFn,fireOnce:true},initToolbar:{defaultFn:A._defInitToolbarFn,fireOnce:true},save:{defaultFn:A._defSaveFn}});A.after({render:A._afterRender,visibleChange:aq.debounce(A._debounceVisibleChange,350,A)});A.on({"form-validator:submit":aq.bind(A._onSubmit,A)});},_afterRender:function(){var A=this;A._handleInitValidatorEvent();A._handleInitToolbarEvent();},_defCancelFn:function(bd){var A=this;A.hide();},_defInitValidatorFn:function(bd){var A=this;A.validator=new aq.FormValidator(A.get(U));},_defInitToolbarFn:function(be){var A=this;var bd=A.get(X);A.toolbar=new aq.Toolbar(A.get(N)).render(A.footerNode);if(bd){A._uiSetEditable(bd);}},_defSaveFn:function(bd){var A=this;if(A.get(at)){A.hide();}},_debounceVisibleChange:function(be){var bd=this;var A=bd._hDocMouseDownEv;if(be.newVal){if(!A){bd._hDocMouseDownEv=aq.getDoc().on(V,aq.bind(bd._onDocMouseDownExt,bd));}}else{if(A){A.detach();bd._hDocMouseDownEv=null;}}},_handleCancelEvent:function(){var A=this;A.fire(aj);},_handleEditEvent:function(){var A=this;A.fire(L);},_handleInitEditEvent:function(){var A=this;if(A.get(a1)){this.fire(m);}},_handleInitValidatorEvent:function(){var A=this;if(A.get(a1)){this.fire(ar);}},_handleInitToolbarEvent:function(){var A=this;if(A.get(a1)&&A.get(W)){this.fire(a8);}},_handleSaveEvent:function(){var A=this;if(!A.validator.hasErrors()){A.fire(aF,{newVal:A.getValue(),prevVal:A.get(aX)});}},_onDocMouseDownExt:function(be){var A=this;var bd=A.get(q);if(!bd.contains(be.target)){A.set(ac,false);}},_onEscKey:function(bd){var A=this;A.hide();},_onSubmit:function(be){var A=this;var bd=be.validator;A._handleSaveEvent();if(bd){bd.formEvent.halt();}},_setToolbar:function(be){var bd=this;var A=bd.getStrings();return aq.merge({activeState:false,children:[{label:A[aF],icon:am,type:aT},{handler:aq.bind(bd._handleCancelEvent,bd),label:A[aj]}]},be);
},_setValidator:function(bd){var A=this;return aq.merge({boundingBox:A.get(u),bubbleTargets:A},bd);},_uiSetShowToolbar:function(be){var A=this;var bd=A.footerNode;if(be){bd.show();}else{bd.hide();}A._handleInitToolbarEvent();},getElementsValue:function(){var A=this;var bd=A.elements;if(bd){return bd.get(aX);}return R;},renderUI:function(){var A=this;if(A.ELEMENT_TEMPLATE){A.elements=aq.Node.create(A.ELEMENT_TEMPLATE);A._syncElementsName();A.setStdModContent(an.BODY,A.elements);}},_defInitEditFn:function(A){},_syncElementsFocus:function(){var A=this;A.elements.selectText();},_syncElementsName:function(){var A=this;A.elements.setAttribute(k,A.get(aA));},_syncFocus:function(){var A=this;aq.later(0,A,A._syncElementsFocus);},_uiSetEditable:function(be){var A=this;var bd=A.toolbar;if(A.get(a1)&&bd){if(be){bd.add({handler:aq.bind(A._handleEditEvent,A),icon:j,label:A.getString(L)},1);}else{bd.remove(1);}}},_uiSetValue:function(be){var A=this;var bd=A.elements;if(bd){bd.val(A.formatValue(A.get(a4),be));}}}});aq.BaseCellEditor=p;var ba=aq.Component.create({NAME:s,ATTRS:{inputFormatter:{value:null},options:{setter:"_setOptions",value:{},validator:H},outputFormatter:{value:null},selectedAttrName:{value:aP,validator:aR},strings:{value:{add:"Add",cancel:"Cancel",addOption:"Add option",edit:"Edit options",editOptions:"Edit option(s)",name:"Name",remove:"Remove",save:"Save",stopEditing:"Stop editing",value:"Value"}}},EXTENDS:aq.BaseCellEditor,UI_ATTRS:[aU],prototype:{EDIT_TEMPLATE:'<div class="'+b+'"></div>',EDIT_OPTION_ROW_TEMPLATE:'<div class="'+az+'">'+'<span class="'+[bb,i,aa].join(a6)+'"></span>'+'<input class="'+aw+'" size="7" placeholder="{titleName}" title="{titleName}" type="text" value="{valueName}" /> '+'<input class="'+aE+'" size="7" placeholder="{titleValue}" title="{titleValue}" type="text" value="{valueValue}" /> '+'<a class="'+[o,aN].join(a6)+'" href="javascript:void(0);">{remove}</a> '+"</div>",EDIT_ADD_LINK_TEMPLATE:'<a class="'+[o,g].join(a6)+'" href="javascript:void(0);">{addOption}</a> ',EDIT_LABEL_TEMPLATE:'<div class="'+al+'">{editOptions}</div>',editContainer:null,editSortable:null,options:null,initializer:function(){var A=this;A.on(L,A._onEditEvent);A.on(aF,A._onSave);A.after(a8,A._afterInitToolbar);},addNewOption:function(bf,bg){var A=this;var be=A.editContainer.one(h+g);var bd=aq.Node.create(A._createEditOption(bf||R,bg||R));be.placeBefore(bd);bd.one(Z).focus();},removeOption:function(A){A.remove();},saveOptions:function(){var A=this;var bg=A.editContainer;if(bg){var bf=bg.all(h+aw);var bd=bg.all(h+aE);var be={};bf.each(function(bj,bi){var bh=bj.val();var bk=bd.item(bi).val();if(bh&&bk){be[bk]=bh;}});A.set(aU,be);A._uiSetValue(A.get(aX));A.toggleEdit();}},toggleEdit:function(){var A=this;A.editContainer.toggle();},_createOptions:function(be){var bi=this;var A=bi.elements;var bg=[];var bd=[];var bf=bi.OPTION_TEMPLATE;var bj=bi.OPTION_WRAPPER;aq.each(be,function(bn,bm){var bl={id:aq.guid(),label:bn,name:bm,value:bm};if(bf){bg.push(ab.sub(bf,bl));}if(bj){bd.push(ab.sub(bj,bl));}});var bk=aq.NodeList.create(bg.join(R));var bh=aq.NodeList.create(bd.join(R));if(bh.size()){bh.each(function(bm,bl){bm.prepend(bk.item(bl));});A.setContent(bh);}else{A.setContent(bk);}bi.options=bk;},_createEditBuffer:function(){var bd=this;var A=bd.getStrings();var be=[];be.push(ab.sub(bd.EDIT_LABEL_TEMPLATE,{editOptions:A[ag]}));aq.each(bd.get(aU),function(bf,bg){be.push(bd._createEditOption(bf,bg));});be.push(ab.sub(bd.EDIT_ADD_LINK_TEMPLATE,{addOption:A[aZ]}));return be.join(R);},_createEditOption:function(be,bf){var bd=this;var A=bd.getStrings();return ab.sub(bd.EDIT_OPTION_ROW_TEMPLATE,{remove:A[a5],titleName:A[k],titleValue:A[aX],valueName:be,valueValue:bf});},_defInitEditFn:function(bd){var A=this;var be=aq.Node.create(A.EDIT_TEMPLATE);be.delegate("click",aq.bind(A._onEditLinkClickEvent,A),h+o);be.delegate("keydown",aq.bind(A._onEditKeyEvent,A),Z);A.editContainer=be;A.setStdModContent(an.BODY,be.hide(),an.AFTER);A.editSortable=new aq.Sortable({container:be,handles:[h+bb],nodes:h+az,opacity:".3"}).delegate.dd.plug(aq.Plugin.DDConstrained,{constrain:be,stickY:true});A._syncEditOptionsUI();},_getSelectedOptions:function(){var A=this;var bd=[];A.options.each(function(be){if(be.get(A.get(ay))){bd.push(be);}});return aq.all(bd);},_onEditEvent:function(bd){var A=this;A._handleInitEditEvent();A.toggleEdit();A._syncEditOptionsUI();},_onEditLinkClickEvent:function(bd){var A=this;var be=bd.currentTarget;if(be.test(h+g)){A.addNewOption();}else{if(be.test(h+a2)){A.toggleEdit();}else{if(be.test(h+aN)){A.removeOption(be.ancestor(h+az));}}}bd.halt();},_onEditKeyEvent:function(bd){var A=this;var be=bd.currentTarget;if(bd.isKey(ae)){var bf=be.next(Z);if(bf){bf.selectText();}else{A.addNewOption();}bd.halt();}},_onSave:function(bd){var A=this;A.saveOptions();},_setOptions:function(bd){var A={};if(e(bd)){a9.each(bd,function(be){A[be]=be;});}else{if(H(bd)){A=bd;}}return A;},_syncEditOptionsUI:function(){var A=this;A.editContainer.setContent(A._createEditBuffer());},_uiSetOptions:function(bd){var A=this;A._uiSetValue(A.get(aX));A._createOptions(bd);A._syncElementsName();},_uiSetValue:function(be){var A=this;var bd=A.options;if(bd&&bd.size()){bd.set(A.get(ay),false);if(be){if(!e(be)){be=String(be).split(bc);}a9.each(be,function(bf){bd.filter('[value="'+ab.trim(bf)+'"]').set(A.get(ay),true);});}}return be;}}});aq.BaseOptionsCellEditor=ba;var ax=aq.Component.create({NAME:w,EXTENDS:aq.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<input autocomplete="off" class="'+S+'" type="text" />'}});aq.TextCellEditor=ax;var aB=aq.Component.create({NAME:Q,EXTENDS:aq.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<textarea class="'+S+'"></textarea>'}});aq.TextAreaCellEditor=aB;var M=aq.Component.create({NAME:aJ,ATTRS:{multiple:{value:false,validator:aM}},EXTENDS:aq.BaseOptionsCellEditor,UI_ATTRS:[Y],prototype:{ELEMENT_TEMPLATE:'<select class="'+S+'"></select>',OPTION_TEMPLATE:'<option value="{value}">{label}</option>',getElementsValue:function(){var A=this;
if(A.get(Y)){return A._getSelectedOptions().get(aX);}return A.elements.get(aX);},_syncElementsFocus:function(){var A=this;A.elements.focus();},_uiSetMultiple:function(be){var A=this;var bd=A.elements;if(be){bd.setAttribute(Y,Y);}else{bd.removeAttribute(Y);}}}});aq.DropDownCellEditor=M;var ak=aq.Component.create({NAME:z,ATTRS:{selectedAttrName:{value:n}},EXTENDS:aq.BaseOptionsCellEditor,prototype:{ELEMENT_TEMPLATE:'<div class="'+S+'"></div>',OPTION_TEMPLATE:'<input class="'+J+'" id="{id}" name="{name}" type="checkbox" value="{value}"/>',OPTION_WRAPPER:'<label class="'+v+'" for="{id}"><span class="'+aQ+'">{label}</span></label>',getElementsValue:function(){var A=this;return A._getSelectedOptions().get(aX);},_syncElementsFocus:function(){var A=this;var bd=A.options;if(bd&&bd.size()){bd.item(0).focus();}},_syncElementsName:function(){var A=this;var bd=A.options;if(bd){bd.setAttribute(k,A.get(aA));}}}});aq.CheckboxCellEditor=ak;var I=aq.Component.create({NAME:ah,EXTENDS:aq.CheckboxCellEditor,prototype:{OPTION_TEMPLATE:'<input class="aui-field-input-choice" id="{id}" name="{name}" type="radio" value="{value}"/>',getElementsValue:function(){var A=this;return A._getSelectedOptions().get(aX)[0];}}});aq.RadioCellEditor=I;var a=aq.Component.create({NAME:K,EXTENDS:aq.BaseCellEditor,ATTRS:{bodyContent:{value:R},calendar:{setter:"_setCalendar",validator:H,value:null},dateFormat:{value:"%D",validator:aR},inputFormatter:{value:function(be){var A=this,bd=[];a9.each(be,function(bg,bf){bd.push(A.formatDate(bg).toString());});return bd;}},outputFormatter:{value:function(be){var A=this,bd=[];a9.each(be,function(bg,bf){bd.push(a3.Date.parse(bg));});return bd;}}},prototype:{ELEMENT_TEMPLATE:'<input class="'+S+'" type="hidden" />',initializer:function(){var A=this;A.after("calendar:dateClick",aq.bind(A._afterDateSelect,A));},getElementsValue:function(){var A=this;return A.calendar.get("selectedDates");},formatDate:function(bf){var bd=this,be=bd.get("dateFormat"),A=bd.get("locale");return a3.Date.format(bf,{format:be});},_afterDateSelect:function(be){var A=this,bd=A.calendar.get("selectedDates");A.elements.val(a9.invoke(bd,"getTime").join(bc));},_afterRender:function(){var A=this;aq.DateCellEditor.superclass._afterRender.apply(A,arguments);A.calendar=new aq.Calendar(A.get(P)).render(A.bodyNode);},_setCalendar:function(bd){var A=this;return aq.merge({bubbleTargets:A},bd);},_uiSetValue:function(bf){var A=this,be=A.calendar,bd;if(be){if(!e(bf)){bf=[bf];}bd=A.formatValue(A.get(a4),bf);be._clearSelection();be.set("date",bd[0]);be.selectDates(bd);}}}});aq.DateCellEditor=a;},"@VERSION@",{skinnable:true,requires:["datatable-base","calendar","aui-datatype","aui-toolbar","aui-form-validator","overlay","sortable"]});