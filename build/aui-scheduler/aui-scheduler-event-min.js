AUI.add("aui-scheduler-event",function(aG){var al=aG.Lang,ba=al.isString,h=al.isDate,a0=al.isFunction,I=al.isObject,a4=al.isBoolean,ab=al.isNumber,aS=aG.ColorUtil,l=aG.DataType.DateMath,aX=aG.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),az=":",bo="-",i=".",ac="",bq="&ndash;",bn=" ",H="_",T="activeView",w="all",M="allDay",V="borderColor",aH="borderColorRGB",aE="borderStyle",bh="borderWidth",K="Change",aV="color",aP="colorBrightnessFactor",a5="colorSaturationFactor",aC="content",a3="day",t="disabled",aI="endDate",aL="eventClass",ar="hidden",J="hsbColor",aq="icon",Z="icons",ai="inherit",aQ="isoTime",bg="locale",bd="meeting",aT="never",p="node",k="overlay",bm="recorder",ae="reminder",a9="repeated",a2="repeater",af="scheduler",at="scheduler-event",av="scheduler-event-recorder",a="short",bc="startDate",aY="template",aO="title",g="titleDateFormat",ao="visible",f="%H:%M",N="%l",bj="%M",am=function(A){var L=[N];if(A.getMinutes()>0){L.push(az);L.push(bj);}if(A.getHours()>=12){L.push("p");}return L.join(ac);},G=aG.getClassName,m=G(aq),s=G(at),F=G(at,w,a3),aJ=G(at,aC),a7=G(at,t),B=G(at,ar),u=G(at,aq,t),D=G(at,aq,bd),ap=G(at,aq,ae),d=G(at,aq,a9),bf=G(at,Z),b=G(at,bd),an=G(at,bm),o=G(at,ae),ay=G(at,a9),ak=G(at,a),C=G(at,aO);var X=aG.Component.create({NAME:at,ATTRS:{allDay:{setter:aG.DataType.Boolean.parse,value:false},borderStyle:{value:"solid",validator:ba},borderWidth:{value:"1px",validator:ba},colorBrightnessFactor:{value:0.75,validator:ab},colorSaturationFactor:{value:1.5,validator:ab},content:{value:"(no title)",validator:ba},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:ba},titleDateFormat:{getter:"_getTitleDateFormat",value:function(){var A=this,L=A.get(af),bt=L&&L.get(T).get(aQ),bu={endDate:bq+bn+f,startDate:f};if(!bt){bu.endDate=bq+bn+am(A.get(aI));bu.startDate=am(A.get(bc));}if(A.getMinutesDuration()<=30){delete bu.endDate;}else{if(A.get(M)){bu={};}}return bu;}},endDate:{setter:"_setDate",valueFn:function(){var A=l.clone(this.get(bc));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aG.SchedulerEvent;}},disabled:{value:false,validator:a4},meeting:{value:false,validator:a4},node:{valueFn:function(){return aG.NodeList.create(aG.Node.create(this.EVENT_NODE_TEMPLATE).setData(at,this));}},reminder:{value:false,validator:a4},repeated:{value:false,validator:a4},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:a4}},EXTENDS:aG.Base,PROPAGATE_ATTRS:[bc,aI,aC,aV,aP,a5,aE,bh,g,ao,t],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+s+'">'+'<div class="'+C+'"></div>'+'<div class="'+aJ+'"></div>'+'<div class="'+bf+'">'+'<span class="'+[m,u].join(bn)+'"></span>'+'<span class="'+[m,D].join(bn)+'"></span>'+'<span class="'+[m,ap].join(bn)+'"></span>'+'<span class="'+[m,d].join(bn)+'"></span>'+"</div>"+"</div>",initializer:function(){var A=this;var L=A.get(p);A.bindUI();A.syncUI();},bindUI:function(){var A=this;A.after({allDayChange:A._afterAllDayChange,colorChange:A._afterColorChange,disabledChange:A._afterDisabledChange,endDateChange:A._afterEndDateChange,meetingChange:A._afterMeetingChange,reminderChange:A._afterReminderChange,repeatedChange:A._afterRepeatedChange,visibleChange:A._afterVisibleChange});},syncUI:function(){var A=this;A._uiSetAllDay(A.get(M));A._uiSetColor(A.get(aV));A._uiSetDisabled(A.get(t));A._uiSetEndDate(A.get(aI));A._uiSetMeeting(A.get(bd));A._uiSetReminder(A.get(ae));A._uiSetRepeated(A.get(a9));A._uiSetVisible(A.get(ao));A.syncNodeTitleUI();A.syncNodeContentUI();},destroy:function(){var A=this;A.get(p).remove(true);},addPaddingNode:function(){var A=this;A.get(p).push(aG.Node.create(A.EVENT_NODE_TEMPLATE).setData(at,A));A.syncUI();},copyDates:function(L){var A=this;A.set(aI,l.clone(L.get(aI)));A.set(bc,l.clone(L.get(bc)));},copyPropagateAttrValues:function(L,bt){var A=this;A.copyDates(L);aG.Array.each(A.get(aL).PROPAGATE_ATTRS,function(bu){if(!((bt||{}).hasOwnProperty(bu))){var bv=L.get(bu);if(!I(bv)){A.set(bu,bv);}}});},getBorderColor:function(){var A=this;return A[aH].hex;},getDaysDuration:function(){var A=this;return l.getDayOffset(A.get(aI),A.get(bc));},getHoursDuration:function(){var A=this;return l.getHoursOffset(A.get(aI),A.get(bc));},getMinutesDuration:function(){var A=this;return l.getMinutesOffset(A.get(aI),A.get(bc));},getSecondsDuration:function(){var A=this;return l.getSecondsOffset(A.get(aI),A.get(bc));},sameEndDate:function(L){var A=this;return l.compare(A.get(aI),L.get(aI));},sameStartDate:function(L){var A=this;return l.compare(A.get(bc),L.get(bc));},isAfter:function(bu){var bt=this;var L=bt.get(bc);var A=bu.get(bc);return l.after(L,A);},isBefore:function(bu){var bt=this;var L=bt.get(bc);var A=bu.get(bc);return l.before(L,A);},intersects:function(bu){var bt=this;var bv=bt.get(aI);var L=bt.get(bc);var A=bu.get(bc);return(bt.sameStartDate(bu)||l.between(A,L,bv));},intersectHours:function(bt){var L=this;var bv=L.get(aI);var A=L.get(bc);var bu=l.clone(A);l.copyHours(bu,bt.get(bc));return(l.compare(A,bu)||l.between(bu,A,bv));},isDayBoundaryEvent:function(){var A=this;return l.isDayBoundary(A.get(bc),A.get(aI));},isDayOverlapEvent:function(){var A=this;return l.isDayOverlap(A.get(bc),A.get(aI));},getClearEndDate:function(){var A=this;return l.safeClearTime(A.get(aI));},getClearStartDate:function(){var A=this;return l.safeClearTime(A.get(bc));},move:function(L){var A=this;var bt=A.getMinutesDuration();A.set(bc,L);A.set(aI,l.add(l.clone(L),l.MINUTES,bt));},setContent:function(L){var A=this;A.get(p).each(function(bu){var bt=bu.one(i+aJ);bt.setContent(L);});},setTitle:function(L){var A=this;A.get(p).each(function(bt){var bu=bt.one(i+C);bu.setContent(L);});},syncNodeContentUI:function(){var A=this;A.setContent(A.get(aC));},syncNodeTitleUI:function(){var L=this,bu=L.get(g),A=L.get(bc),bt=L.get(aI),bv=[];if(bu.startDate){bv.push(L._formatDate(A,bu.startDate));}if(bu.endDate){bv.push(L._formatDate(bt,bu.endDate));}L.setTitle(bv.join(bn));
},split:function(){var A=this,bt=l.clone(A.get(bc)),bu=l.clone(A.get(aI));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=l.clone(bt);L.setHours(24,0,0,0);return[[bt,l.toMidnight(l.clone(bt))],[L,l.clone(bu)]];}return[[bt,bu]];},_afterAllDayChange:function(L){var A=this;A._uiSetAllDay(L.newVal);},_afterColorChange:function(L){var A=this;A._uiSetColor(L.newVal);},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterEndDateChange:function(L){var A=this;A._uiSetEndDate(L.newVal);},_afterMeetingChange:function(L){var A=this;A._uiSetMeeting(L.newVal);},_afterReminderChange:function(L){var A=this;A._uiSetReminder(L.newVal);},_afterRepeatedChange:function(L){var A=this;A._uiSetRepeated(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_setColor:function(L){var A=this;A[J]=aS.rgb2hsb(aS.getRGB(L));A[V]=aG.clone(A[J]);A[V].b*=A.get(aP);A[V].s*=A.get(a5);A[aH]=aS.hsb2rgb(A[V]);return L;},_setDate:function(L){var A=this;if(ab(L)){L=new Date(L);}return L;},_setScheduler:function(bt){var A=this;var L=A.get(af);if(L){A.removeTarget(L);}A.addTarget(bt);return bt;},_formatDate:function(bt,bu){var L=this;var A=L.get(bg);return aG.DataType.Date.format(bt,{format:bu,locale:A});},_getTitleDateFormat:function(L){var A=this;if(ba(L)){L={endDate:L,startDate:L};}else{if(a0(L)){L=L.call(A);}}return L;},_uiSetAllDay:function(L){var A=this;A.get(p).toggleClass(F,!!L);},_uiSetColor:function(bu){var A=this;var bt=A.get(p);var bv=A.getBorderColor();if(bt){var L={borderWidth:A.get(bh),borderColor:bv,backgroundColor:bu,borderStyle:A.get(aE),color:ai};bt.setStyles(L);}},_uiSetDisabled:function(L){var A=this;A.get(p).toggleClass(a7,!!L);},_uiSetEndDate:function(L){var A=this;A.get(p).toggleClass(ak,A.getMinutesDuration()<=30);},_uiSetMeeting:function(L){var A=this;A.get(p).toggleClass(b,!!L);},_uiSetReminder:function(L){var A=this;A.get(p).toggleClass(o,!!L);},_uiSetRepeated:function(L){var A=this;A.get(p).toggleClass(ay,!!L);},_uiSetVisible:function(L){var A=this;A.get(p).toggleClass(B,!L);}}});aG.SchedulerEvent=X;var au=aG.Lang,c=au.isArray,e="arrow",aN="body",ax="bodyContent",q="boundingBox",aw="cancel",aU="click",E="constrain",aM="date",aD="dateFormat",aj="delete",a1="description",bl="event",z="footerContent",aB="form",y="header",R="offsetHeight",a8="offsetWidth",U="overlayOffset",bi="rendered",j="right",aW="save",n="schedulerChange",aA="shadow",Q="strings",bk="tl",aa="toolbar",bb="submit",be="value",aK="visibleChange",S="width",ad="cancel",P="delete",x="edit",aF="save",r=aG.IO.prototype._serialize,bp=G(af,bl,bm,k),v=G(af,bl,bm,k,e),a6=G(af,bl,bm,k,e,aA),aR=G(af,bl,bm,k,e,j),ah=G(af,bl,bm,k,aN),aZ=G(af,bl,bm,k,aC),ag=G(af,bl,bm,k,aM),W=G(af,bl,bm,k,aB),bs=G(af,bl,bm,k,y),O=new aG.Template('<div class="',a6," ",v,'"></div>','<div class="',v,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bs,'">','<input class="',aZ,'" name="content" value="{content}" />',"</div>",'<div class="',ah,'">','<label class="',ag,'">{date}</label>',"</div>"),br='<form class="'+W+'" id="schedulerEventRecorderForm"></form>';var Y=aG.Component.create({NAME:av,ATTRS:{allDay:{value:false},content:{value:ac},duration:{value:60},dateFormat:{validator:ba,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aG.SchedulerEvent;}},strings:{value:{},setter:function(A){return aG.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's",cancel:"Cancel",description:"Description",edit:"Edit",save:"Save",when:"When"},A||{});},validator:I},overlay:{validator:I,value:{constrain:null,visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:c},template:{value:O},toolbar:{setter:function(bt){var L=this;var A=L.get(Q);return aG.merge({children:[{handler:aG.bind(L._handleSaveEvent,L),label:A[aW]},{handler:aG.bind(L._handleCancelEvent,L),label:A[aw]},{handler:aG.bind(L._handleDeleteEvent,L),label:A[aj]}]},bt||{});},validator:I,value:{}}},EXTENDS:aG.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(p).addClass(an);A.publish(ad,{defaultFn:A._defCancelEventFn});A.publish(P,{defaultFn:A._defDeleteEventFn});A.publish(x,{defaultFn:A._defEditEventFn});A.publish(aF,{defaultFn:A._defSaveEventFn});A.after(n,A._afterSchedulerChange);A[k]=new aG.Overlay(A.get(k));A[aa]=new aG.Toolbar(A.get(aa));},_afterSchedulerChange:function(bu){var A=this;var bt=bu.newVal;var L=bt.get(q);A[k].set(E,L);L.delegate(aU,aG.bind(A._onClickSchedulerEvent,A),i+s);},_defCancelEventFn:function(L){var A=this;A.get(p).remove();A.hideOverlay();},_defDeleteEventFn:function(bt){var A=this;var L=A.get(af);L.removeEvent(A.get(bl));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(bt){var A=this;var L=A.get(af);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(bt){var A=this;var L=A.get(af);L.addEvent(bt.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ad);L.preventDefault();},_handleDeleteEvent:function(L){var A=this;A.fire(P,{schedulerEvent:A.get(bl)});L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bl)?x:aF,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickSchedulerEvent:function(bt){var A=this;var L=bt.currentTarget.getData(at);if(L){A.set(bl,L);A.showOverlay([bt.pageX,bt.pageY]);A.get(p).remove();}},_onOverlayVisibleChange:function(bu){var L=this;if(bu.newVal){L.populateForm();if(!L.get(bl)){var bt=L[k].get(q);var A=bt.one(i+aZ);setTimeout(function(){A.selectText();},0);}}else{L.set(bl,null);L.get(p).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(Q);L[k].render();L[aa].render();var bt=L[k].get(q);bt.addClass(bp);L[k].set(z,L[aa].get(q));L[k].on(aK,aG.bind(L._onOverlayVisibleChange,L));L.formNode=aG.Node.create(br);L[k].set(ax,L.formNode);L.formNode.on(bb,aG.bind(L._onSubmitForm,L));},getEventCopy:function(){var A=this;
var bt=A.get(bl);if(!bt){bt=new (A.get(aL))({allDay:A.get(M),endDate:A.get(aI),scheduler:A.get(af),startDate:A.get(bc)});bt.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();bt.set(aC,L[aC]);bt.set(a9,L[a9]);return bt;},getFormattedDate:function(){var bt=this;var L=bt.get(aD);var bv=(bt.get(bl)||bt);var bx=bv.get(aI);var bw=bv.get(af);var A=bv.get(bc);var bu=(bw.get(T).get(aQ)?l.toIsoTimeString:l.toUsTimeString);return[bv._formatDate(A,L),bu(A),bo,bu(bx)].join(bn);},getTemplateData:function(){var L=this;var A=L.get(Q);var bt=(L.get(bl)||L);return{content:bt.get(aC)||A["description-hint"],date:L.getFormattedDate(),endDate:bt.get(aI).getTime(),repeated:bt.get(a9),startDate:bt.get(bc).getTime()};},hideOverlay:function(){var A=this;A[k].hide();},populateForm:function(){var A=this;A.formNode.setContent(A.get(aY).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aG.QueryString.parse(r(A.formNode.getDOM()));},showOverlay:function(bu,bv){var bF=this,bC=bF[k].get(E),bw=bF.get(U),bD=bu.concat([]),bx=bF[k].get(q),bz=bx.get(R),bt=bx.get(a8);if(!bF[k].get(bi)){bF._renderOverlay();}bF[k].show();if(!bu){var bH=(bF.get(bl)||bF).get(p);var bB=bH.one(i+C);bv=[bw[0]+bB.get(a8),bw[1]+bB.get(R)/2];bu=bB.getXY();}bv=bv||bw;bu[0]+=bv[0];bu[1]+=bv[1];var by=bx.all(i+v),L,bG=by.item(0),bI=bG.get(R),bA=bC.get(a8),A=bC.get(R),bE=bC.getY()+A;if((bu[0]+bt)>=bA){by.addClass(aR);bu[0]-=bt+bG.get(a8);}bF[k].set("xy",bu);if(bD[1]>=(bE-bI/2)){L=bx.getY()+bz-bI;}else{L=bD[1]-bI/2;}by.setY(L);}}});aG.SchedulerEventRecorder=Y;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});