AUI.add("aui-color-picker",function(S){var G=S.Lang,N=G.isArray,L=G.isObject,H="colorpicker",J=S.ClassNameManager.getClassName,c=S.WidgetStdMod,I=J(H,"canvas"),d=J(H,"hue-canvas"),Q=J(H,"container"),T=J(H,"controls"),M=J(H,"panel"),R=J(H,"swatch"),D=J(H,"swatch-current"),Y=J(H,"swatch-original"),U=J(H,"thumb"),O=J(H,"thumb-image"),K=J(H,"hue-thumb"),E=J(H,"hue-thumb-image"),Z=J(H,"hue","slider"),X=J(H,"hue","slider","content"),F=J(H,"trigger"),a='<div class="'+I+'"></div>',W='<span class="'+d+'"></span>',P='<div class="'+R+'"></div>',f='<div class="'+D+'"></div>',C='<div class="'+Y+'"></div>',V='<div class="'+U+'"><div class="'+O+'"></div></div>',b='<span class="'+K+'"><span class="'+E+'"></span></span>';var e={real2dec:function(g){var A=this;return Math.min(255,Math.round(g*256));},hsv2rgb:function(m,l,o){var s=this;if(N(m)){return s.hsv2rgb.apply(s,m);}else{if(L(m)){l=m.saturation;o=m.value;m=m.hue;}}m=s.constrainTo(m,0,360,0);o=s.constrainTo(o,0,1,0);l=s.constrainTo(l,0,1,0);var h,j,r,k=Math.floor((m/60)%6),n=(m/60)-k,g=o*(1-l),A=o*(1-n*l),v=o*(1-(1-n)*l);switch(k){case 0:h=o;j=v;r=g;break;case 1:h=A;j=o;r=g;break;case 2:h=g;j=o;r=v;break;case 3:h=g;j=A;r=o;break;case 4:h=v;j=g;r=o;break;case 5:h=o;j=g;r=A;break;}var u=s.real2dec;return{red:u(h),green:u(j),blue:u(r)};},rgb2hex:function(j,i,g){var A=this;if(N(j)){return A.rgb2hex.apply(A,j);}else{if(L(j)){i=j.green;g=j.blue;j=j.red;}}var h=A.dec2hex;return h(j)+h(i)+h(g);},dec2hex:function(g){var A=this;g=parseInt(g,10)|0;g=e.constrainTo(g,0,255,0);return("0"+g.toString(16)).slice(-2).toUpperCase();},hex2dec:function(g){var A=this;return parseInt(g,16);},hex2rgb:function(h){var g=this;var i=g.hex2dec;var k=h.slice(0,2);var j=h.slice(2,4);var A=h.slice(4,6);return{red:i(k),green:i(j),blue:i(A)};},rgb2hsv:function(A,l,g){var n=this;if(N(A)){return n.rgb2hsv.apply(n,A);}else{if(L(A)){g=A.green;l=A.blue;A=A.red;}}A/=255;g/=255;l/=255;var j,i,h=Math.min(Math.min(A,g),l),k=Math.max(Math.max(A,g),l),m=k-h;switch(k){case h:j=0;break;case A:j=60*(g-l)/m;if(g<l){j+=360;}break;case g:j=(60*(l-A)/m)+120;break;case l:j=(60*(A-g)/m)+240;break;}i=(k===0)?0:1-(h/k);return{hue:Math.round(j),saturation:i,value:k};},constrainTo:function(i,j,g,h){var A=this;if(i<j||i>g){i=h;}return i;}};var B=S.Component.create({NAME:H,ATTRS:{colors:{value:{},getter:function(){var A=this;var h=A.get("rgb");var i=A.get("hex");var g={};S.mix(g,h);g.hex=i;return g;}},hex:{value:"FFFFFF",getter:function(){var A=this;var g=A.get("rgb");return e.rgb2hex(g);},setter:function(l){var A=this;var k=l.length;if(k==3){var j=l.split("");for(var h=0;h<j.length;h++){j[h]+=j[h];}l=j.join("");}if((/[A-Fa-f0-9]{6}/).test(l)){var g=e.hex2rgb(l);A.set("rgb",g);}else{l=S.Attribute.INVALID_VALUE;}return l;}},hideOn:{value:"click"},hsv:{getter:function(h){var A=this;var g=A.get("rgb");return e.rgb2hsv(g);},setter:function(h){var A=this;if(N(h)){var i=A.get("hsv");var g=e.hsv2rgb(h);A.set("rgb",g);i={hue:h[0],saturation:h[1],value:[2]};}else{if(!L(h)){h=S.Attribute.INVALID_VALUE;}}return h;},value:{hue:0,saturation:0,value:0}},showOn:{value:"click"},pickersize:{value:180},rgb:{value:{blue:255,green:255,red:255},setter:function(g){var A=this;if(N(g)){var h=A.get("rgb");h={blue:g[2],green:g[1],red:[0]};g=h;}else{if(!L(g)){g=S.Attribute.INVALID_VALUE;}}g.red=e.constrainTo(g.red,0,255,255);g.green=e.constrainTo(g.green,0,255,255);g.blue=e.constrainTo(g.blue,0,255,255);return g;}},strings:{value:{R:"R",G:"G",B:"B",H:"H",S:"S",V:"V",HEX:"#",DEG:"\u00B0",PERCENT:"%"}},triggerParent:{value:null},trigger:{lazyAdd:true,getter:function(g){var A=this;if(!g){A._buttonTrigger=new S.ButtonItem({cssClass:F,icon:"pencil"});g=A._buttonTrigger.get("boundingBox");A.set("trigger",g);}return g;}}},EXTENDS:S.OverlayContext,prototype:{renderUI:function(){var A=this;var h=A._buttonTrigger;if(h&&!h.get("rendered")){var g=A.get("triggerParent");if(!g){g=A.get("boundingBox").get("parentNode");}h.render(g);}A._renderContainer();A._renderSliders();A._renderControls();},bindUI:function(){var A=this;B.superclass.bindUI.apply(this,arguments);A._createEvents();A._colorCanvas.on("mousedown",A._onCanvasMouseDown,A);A._colorPicker.on("drag:start",A._onThumbDragStart,A);A._colorPicker.after("drag:drag",A._afterThumbDrag,A);A._hueSlider.after("valueChange",A._afterValueChange,A);var g=A._colorForm.get("contentBox");g.delegate("change",S.bind(A._onFormChange,A),"input");A.after("hexChange",A._updateRGB);A.after("rgbChange",A._updateRGB);A._colorSwatchOriginal.on("click",A._restoreRGB,A);A.after("visibleChange",A._afterVisibleChangeCP);},syncUI:function(){var A=this;A._updatePickerOffset();var g=A.get("rgb");A._updateControls();A._updateOriginalRGB();},_afterThumbDrag:function(g){var A=this;var h=A._translateOffset(g.pageX,g.pageY);if(!A._preventDragEvent){A.fire("colorChange",{ddEvent:g});}A._canvasThumbXY=h;},_afterValueChange:function(g){var A=this;if(g.src!="controls"){A.fire("colorChange",{slideEvent:g});}},_afterVisibleChangeCP:function(g){var A=this;if(g.newVal){A.refreshAlign();A._hueSlider.syncUI();}A._updateOriginalRGB();},_convertOffsetToValue:function(g,i){var A=this;if(N(g)){return A._convertOffsetToValue.apply(A,g);}var h=A.get("pickersize");g=Math.round(((g*h/100)));i=Math.round((h-(i*h/100)));return[g,i];},_convertValueToOffset:function(g,h){var A=this;if(N(g)){return A._convertValueToOffset.apply(A,g);}g=Math.round(g+A._offsetXY[0]);h=Math.round(h+A._offsetXY[1]);return[g,h];},_createEvents:function(){var A=this;A.publish("colorChange",{defaultFn:A._onColorChange});},_getHuePicker:function(){var A=this;var h=A._getPickerSize();var g=(h-A._hueSlider.get("value"))/h;g=Math.round(g*360);return(g===360)?0:g;},_getPickerSize:function(){var A=this;if(!A._pickerSize){var g=A._colorCanvas;var h=g.get("offsetWidth");if(!h){h=g.getComputedStyle("width");}h=parseInt(h,10);var i=A._pickerThumb.get("offsetWidth");h-=i;A._pickerSize=h;}return A._pickerSize;},_getSaturationPicker:function(){var A=this;return A._canvasThumbXY[0]/A._getPickerSize();
},_getThumbOffset:function(){var g=this;if(!g._thumbOffset){var h=g._pickerThumb;var A=h.get("offsetHeight");var i=h.get("offsetWidth");g._thumbOffset=[Math.floor(i/2),Math.floor(A/2)];}return g._thumbOffset;},_getValuePicker:function(){var A=this;var g=A._getPickerSize();return((g-A._canvasThumbXY[1]))/g;},_onCanvasMouseDown:function(g){var A=this;A._setDragStart(g.pageX,g.pageY);g.halt();A.fire("colorChange",{ddEvent:g});},_onColorChange:function(j){var A=this;var g=A._getHuePicker();var i=A._getSaturationPicker();var k=A._getValuePicker();var h=e.hsv2rgb(g,i,k);if(j.src!="controls"){A.set("rgb",h);}A._updateControls();if(!j.ddEvent){if(!j.slideEvent){A._updateHue();A._updatePickerThumb();g=A._getHuePicker();}var l=e.hsv2rgb(g,1,1);A._updateCanvas(l);}A._updateColorSwatch();},_onFormChange:function(h){var A=this;var g=h.currentTarget;var i=g.get("id");if(i!="hex"){i="rgb."+i;}A.set(i,g.val());},_onThumbDragStart:function(g){var A=this;A._updatePickerOffset();},_renderContainer:function(){var A=this;if(!A._pickerContainer){var g=new S.Panel({cssClass:M,icons:[{icon:"close",id:"close",handler:{fn:A.hide,context:A}}]}).render(A.get("contentBox"));var h=g.bodyNode;h.addClass(Q);A._pickerContainer=h;}},_renderControls:function(){var g=this;g._colorSwatch=S.Node.create(P);g._colorSwatchCurrent=S.Node.create(f);g._colorSwatchOriginal=S.Node.create(C);g._colorSwatch.appendChild(g._colorSwatchCurrent);g._colorSwatch.appendChild(g._colorSwatchOriginal);g._pickerContainer.appendChild(g._colorSwatch);var A=g.get("strings");var h=new S.Form({labelAlign:"left"}).render(g._pickerContainer);h.add([{id:"red",labelText:A.R,size:3},{id:"green",labelText:A.G,size:3},{id:"blue",labelText:A.B,size:3},{id:"hex",labelText:A.HEX,size:6}],true);h.get("boundingBox").addClass(T);g._colorForm=h;},_renderSliders:function(){var A=this;A._colorCanvas=S.Node.create(a);A._pickerThumb=S.Node.create(V);A._colorCanvas.appendChild(A._pickerThumb);A._pickerContainer.appendChild(A._colorCanvas);var g=A.get("pickersize");A._colorPicker=new S.DD.Drag({node:A._pickerThumb}).plug(S.Plugin.DDConstrained,{constrain2node:A._colorCanvas});var h=new S.Slider({axis:"y",min:0,max:g,length:A._colorCanvas.get("offsetHeight")});h.RAIL_TEMPLATE=W;h.THUMB_TEMPLATE=b;h.get("boundingBox").addClass(Z);h.get("contentBox").addClass(X);h.render(A._pickerContainer);A._hueSlider=h;},_restoreRGB:function(g){var A=this;A.set("rgb",A._oldRGB);A._updateHue();A._updatePickerThumb();A._updateColorSwatch();A.fire("colorChange");},_setDragStart:function(h,k){var g=this;if(N(h)){return g._setDragStart.apply(g,h);}var A=g._colorPicker;A._dragThreshMet=true;A._fixIEMouseDown();S.DD.DDM.activeDrag=A;var j=A.get("dragNode").getXY();var i=g._getThumbOffset();j[0]+=i[0];j[1]+=i[1];A._setStartPosition(j);A.set("activeHandle",A.get("dragNode"));A.start();A._alignNode([h,k]);},_translateOffset:function(g,j){var A=this;var h=A._offsetXY;var i=[];i[0]=Math.round(g-h[0]);i[1]=Math.round(j-h[1]);return i;},_updateCanvas:function(g){var A=this;g=g||A.get("rgb");A._colorCanvas.setStyle("backgroundColor","rgb("+[g.red,g.green,g.blue].join(",")+")");},_updateColorSwatch:function(g){var A=this;g=g||A.get("rgb");A._colorSwatchCurrent.setStyle("backgroundColor","rgb("+[g.red,g.green,g.blue].join(",")+")");},_updateControls:function(){var A=this;var g=A.get("colors");A._colorForm.set("values",g);},_updateHue:function(){var A=this;var h=A._getPickerSize();var g=A.get("hsv.hue");g=h-Math.round(g/360*h);if(g===h){g=0;}A._hueSlider.set("value",g,{src:"controls"});},_updateOriginalColorSwatch:function(g){var A=this;g=g||A.get("rgb");A._colorSwatchOriginal.setStyle("backgroundColor","rgb("+[g.red,g.green,g.blue].join(",")+")");},_updateOriginalRGB:function(){var A=this;A._oldRGB=A.get("rgb");A._updateOriginalColorSwatch(A._oldRGB);},_updatePickerOffset:function(){var A=this;A._offsetXY=A._colorCanvas.getXY();},_updatePickerThumb:function(){var g=this;g._updatePickerOffset();var h=g.get("hsv");var i=g.get("pickersize");h.saturation=Math.round(h.saturation*100);var j=h.saturation;h.value=Math.round(h.value*100);var k=h.value;var l=g._convertOffsetToValue(j,k);l=g._convertValueToOffset(l);g._canvasThumbXY=l;var A=g._colorPicker;g._preventDragEvent=true;A._setStartPosition(A.get("dragNode").getXY());A._alignNode(l,true);g._preventDragEvent=false;},_updateRGB:function(g){var A=this;if(g.subAttrName||g.attrName=="hex"){A.fire("colorChange",{src:"controls"});}},_canvasThumbXY:[0,0],_offsetXY:[0,0]}});B.Color=e;S.ColorPicker=B;},"@VERSION@",{requires:["aui-overlay-context","dd-drag","slider","substitute","aui-button-item","aui-form-base","aui-panel"],skinnable:true});